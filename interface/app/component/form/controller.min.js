PaymentPage.Component.form={kit_injections:["data-payment-page-button","data-payment-page-notification"],container:{},configuration:{layout:"default",fields:[],field_namespace:"payment_page_form",field_nonce:"",field_nonce_value:""},Init:function(e){this.container=e;let t=this;payment_page_component_configuration_parse(this,(function(){PaymentPage.Template.preload("form","template/field.html",(function(){t.container.attr("data-payment-page-layout",t.configuration.layout),jQuery.fn.select2?t.loadTemplate():PaymentPage.LoadAssets(PaymentPage.settings.libraries.select2,(function(){t.loadTemplate()}))}))}))},loadTemplate:function(){let e=this;PaymentPage.Template.load(this.container,"form","template/default.html",this.configuration,(function(){e._bindEvents()}))},_bindEvents:function(){let e=this;this.container.find("select[multiple]").select2({}),this.container.find('[data-payment-page-component-form-trigger="remove"]').off("click").on("click",(function(e){jQuery(this).parents('[data-payment-page-component-form-section="repeater_form_item"]:first').slideUp("slow",(function(){jQuery(this).remove()}))})),this.container.find('[data-payment-page-component-form-section="repeater_form_item"] > [data-payment-page-component-form-section="repeater_form_item_header"] > h4').off("click").on("click",(function(e){let t=jQuery(this).parents('[data-payment-page-component-form-section="repeater_form_item"]:first');void 0!==t.attr("data-payment-page-interaction-state")&&"none"===t.attr("data-payment-page-interaction-state")?t.attr("data-payment-page-interaction-state","collapsed"):t.attr("data-payment-page-interaction-state","none"),PaymentPage.Library.Conditionaldisplay.refresh()})),this.container.find('[data-payment-page-component-form-trigger="add_repeater"]').off("click").on("click",(function(t){t.preventDefault();let a=payment_page_get_random_string(),n=jQuery(this).parents('[data-payment-page-component-form-section="repeater_form_wrapper"]:first'),i=n.find('[data-payment-page-component-form-section="repeater_form_item_container"]:first'),o=n.attr("data-repeater-field-input-name")+"["+a+"]",r=n.attr("data-payment-page-layout"),d="",p=n.attr("data-repeater-field-name"),l=[];if(0===n.parents('[data-payment-page-component-form-section="repeater_form_wrapper"]:first').length)l=e._repeaterFieldFields(p,e.configuration.fields);else{let t=[];n.parents('[data-payment-page-component-form-section="repeater_form_wrapper"]').each((function(){t.push(jQuery(this).attr("data-repeater-field-name"))})),t=t.reverse();let a=e.configuration.fields;jQuery.each(t,(function(t,n){a=e._repeaterFieldFields(n,a)})),l=e._repeaterFieldFields(p,a)}if("basic"===r)d+='<div data-payment-page-component-form-section="repeater_form_item" data-field-namespace="'+o+'">',d+='<div data-payment-page-component-form-section="repeater_form_item_content">',d+=PaymentPage.Template.get("form","template/default",{fields:l,field_namespace:o}),d+="</div>",d+='<div data-payment-page-component-form-section="repeater_form_item_footer">',d+='<button type="button" data-payment-page-button="danger" data-payment-page-component-form-trigger="remove">'+PaymentPage.lang.delete+"</button>",d+="</div>",d+="</div>";else{let e=!1;d+='<div data-payment-page-component-form-section="repeater_form_item" data-field-namespace="'+o+'">',d+='<div data-payment-page-component-form-section="repeater_form_item_header">',d+="<h4>",d+='<span data-payment-page-component-form-trigger="order">'+PaymentPage.settings.svg_icon_map.element_order+"</span>",jQuery(l).each((function(t,a){void 0!==a.admin_label&&a.admin_label&&(d+='<strong data-label-key="{{ parsed_field_information.name }}">'+(void 0!==a.default?a.default:"")+"</strong>",e=!0)})),e||(d+="<span>Item #"+(i.find('[data-payment-page-component-form-section="repeater_form_item"]').length+1)+"</span>"),d+="<i>"+PaymentPage.settings.svg_icon_map.angle_down+"</i>",d+="</h4>",d+='<button type="button" data-payment-page-button="danger" data-payment-page-component-form-trigger="remove">'+PaymentPage.lang.delete+"</button>",d+="</div>",d+='<div data-payment-page-component-form-section="repeater_form_item_content">',d+=PaymentPage.Template.get("form","template/default",{fields:l,field_namespace:o}),d+="</div>",d+="</div>"}i.append(d),PaymentPage.Init(i.find('[data-field-namespace="'+o+'"]')),e._bindEvents(),PaymentPage.Library.Conditionaldisplay.refresh()})),this.container.find(":input[data-payment-page-is-admin-label]").off("keyup.pp_repeater_admin_label change.pp_repeater_admin_label").on("keyup.pp_repeater_admin_label change.pp_repeater_admin_label",(function(){let e=jQuery(this).parents('[data-payment-page-component-form-section="repeater_form_item"]:first').find('[data-payment-page-component-form-section="repeater_form_item_header"]:first'),t=jQuery(this).attr("name").slice(jQuery(this).attr("name").lastIndexOf("][")+2);t=t.replace("]",""),e.find('[data-label-key="'+t+'"]:first').text(jQuery(this).val())})),this.container.find('[data-payment-page-component-form-section="field_container_message_builder"]').not(".loaded-message-builder").each((function(){jQuery(this).addClass("loaded-message-builder");let e=jQuery(this).find('> [data-payment-page-scope="field_list"]'),t=jQuery(this).find('> [data-payment-page-scope="field_order"]'),a=jQuery(this).find("> textarea"),n=a.val().split(","),i=function(){let e=[];t.find("> li").each((function(){e.push(jQuery(this).attr("data-field-key"))})),a.val(e.join(","))};e.find(":input").off("change keyup").on("change keyup",(function(){let a="checkbox"===jQuery(this).attr("type")?jQuery(this).is(":checked"):""!==jQuery(this).val(),n=jQuery(this).parents("[data-payment-page-field-key]:first").attr("data-payment-page-field-key");a?0===t.find('[data-field-key="'+n+'"]').length&&(t.append('<li data-field-key="'+n+'">'+e.find(':input[name$="['+n+']"]').parents("[data-payment-page-scope]:first").find(" > label").text()+"</li>"),i()):0!==t.find('[data-field-key="'+n+'"]').length&&(t.find('[data-field-key="'+n+'"]').remove(),i())})),jQuery.each(n,(function(a,n){""!==n&&t.append('<li data-field-key="'+n+'">'+e.find(':input[name$="['+n+']"]').parents("[data-payment-page-scope]:first").find(" > label").text()+"</li>")})),PaymentPage.Library.Sortable.Init(t,{onUpdate:i})})),e.container.find('[data-payment-page-component-form-section="field_wrapper_repeater"] [data-payment-page-component-form-section="repeater_form_item_container"]').each((function(){0!==jQuery(this).find('[data-payment-page-component-form-trigger="order"]').length&&PaymentPage.Library.Sortable.Init(jQuery(this),{handle:'[data-payment-page-component-form-trigger="order"]'})})),this.container.find('[data-payment-page-component-form-section="fields_map_form_wrapper"]').each((function(){if(void 0!==jQuery(this).attr("data-payment-page-interaction-state")&&"loaded"===jQuery(this).attr("data-payment-page-interaction-state"))return;let t=jQuery(this),a=t.find("> textarea"),n=t.find('> [data-payment-page-component-form-section="fields_map_form_container"]'),i=t.find('[data-payment-page-component-form-trigger="fields_map_form_add"]'),o=Object.values(JSON.parse(a.val())),r=[];jQuery.each(o,(function(e,t){void 0!==t.order?t.order=parseInt(t.order):t.order=0,r.push(t)})),r=_.sortBy(r,"order"),jQuery.each(r,(function(t,i){e._fieldsMapAttachField(i,n,a)})),PaymentPage.Library.Sortable.Init(n,{handle:'[data-payment-page-component-form-trigger="fields_map_form_item_order"]',onUpdate:function(){n.find('> [data-payment-page-component-form-section="field_container"]').each((function(){jQuery(this).find('[data-setting="order"]').val(jQuery(this).index())})),e._fieldsMapSyncToTextarea(n,a)}}),i.off("click").on("click",(function(t){t.preventDefault(),e._fieldsMapAttachField({name:"custom_field_"+Date.now(),type:"custom",size:6,size_mobile:0,order:n.find('> [data-payment-page-component-form-section="field_container"]').length},n,a),e._fieldsMapSyncToTextarea(n,a)})),t.attr("data-payment-page-interaction-state","loaded")}))},_fieldsMapAttachField:function(e,t,a){let n=this,i="";i+='<div data-payment-page-component-form-section="field_container">',i+='<div data-payment-page-component-form-section="field_container_draggable_container">',i+='<span data-payment-page-component-form-trigger="fields_map_form_item_order">',i+=PaymentPage.settings.svg_icon_map.element_order,i+="</span>",i+="</div>",i+='<div data-payment-page-component-form-section="field_container_information_container">',i+='<input data-setting="key" type="hidden" value="'+(void 0!==e.name?e.name:"")+'">',i+='<input data-setting="type" type="hidden" value="'+(void 0!==e.type?e.type:"")+'">',i+='<input data-setting="order" type="hidden" value="'+(void 0!==e.order?e.order:"0")+'">',i+='<div data-setting-container="label">',i+="<label>",i+="<span>Label</span>",i+='<input data-setting="label" class="field" type="text" value="'+(void 0!==e.label?e.label:"")+'">',i+="</label>",i+="</div>",-1===jQuery.inArray(e.type,["payment_method_card","payment_method_iban"])&&(i+='<div data-setting-container="placeholder">',i+="<label>",i+="<span>Placeholder</span>",i+='<input data-setting="placeholder" class="field" type="text" value="'+(void 0!==e.placeholder?e.placeholder:"")+'">',i+="</label>",i+="</div>"),"custom"===e.type&&(i+='<div data-setting-container="is_required">',i+="<label>",i+="<span>Is Required</span>",i+='<input data-setting="is_required" class="field" type="checkbox" value="1" '+(void 0!==e.is_required&&parseInt(e.is_required)?'checked="checked"':"")+">",i+="</label>",i+="</div>"),"card_zip_code"===e.name&&(i+='<div data-setting-container="is_hidden">',i+="<label>",i+="<span>Hide on checkout</span>",i+='<input data-setting="is_hidden" class="field" type="checkbox" value="1" '+(void 0!==e.is_hidden&&parseInt(e.is_hidden)?'checked="checked"':"")+">",i+="</label>",i+="</div>"),i+='<div data-setting-container="size">',i+="<label>",i+="<span>Size</span>",i+='<select data-setting="size">',jQuery.each([1,2,3,4,5,6],(function(t,a){i+='<option value="'+a+'" '+(void 0!==e.size&&parseInt(e.size)===a?'selected="selected"':"")+">"+a+"/6</option>"})),i+="</select>",i+="</label>",i+="</div>",i+='<div data-setting-container="size_mobile">',i+="<label>",i+="<span>Size Mobile</span>",i+='<select data-setting="size_mobile">',jQuery.each([0,1,2,3,4,5,6],(function(t,a){i+='<option value="'+a+'" '+(void 0!==e.size_mobile&&parseInt(e.size_mobile)===a?'selected="selected"':"")+">",i+=0===a?"Inherit":a+"/6",i+="</option>"})),i+="</select>",i+="</label>",i+="</div>","custom"===e.type&&(i+='<p><span class="remove-field" data-payment-page-button="danger">Remove</span></p>'),i+="</div>",i+="</div>",t.append(i);let o=t.find('> [data-payment-page-component-form-section="field_container"]:last');o.find("[data-setting]").on("keyup change",(function(e){n._fieldsMapSyncToTextarea(t,a)})),o.find(".remove-field").off("click").on("click",(function(){jQuery(this).parents('[data-payment-page-component-form-section="field_container"]:first').remove(),n._fieldsMapSyncToTextarea(t,a)}))},_fieldsMapSyncToTextarea:function(e,t){let a={};e.find('> [data-payment-page-component-form-section="field_container"]').each((function(){let e=jQuery(this).find('[data-setting="key"]').val(),t=jQuery(this).find('[data-setting="type"]').val(),n=jQuery(this).find('[data-setting="order"]').val(),i=jQuery(this).find('[data-setting="label"]').val(),o=jQuery(this).find('[data-setting="size"]').val(),r=jQuery(this).find('[data-setting="size_mobile"]').val(),d=jQuery(this).find('[data-setting="is_hidden"]'),p=jQuery(this).find('[data-setting="is_required"]'),l=jQuery(this).find('[data-setting="placeholder"]');a[e]={label:i,name:e,placeholder:l.length>0?l.val():"",is_required:p.length>0?p.is(":checked")?1:0:1,type:t,size:o,size_mobile:r,order:n},d.length>0&&(a[e].is_hidden=d.is(":checked")?1:0)})),t.val(JSON.stringify(a)).trigger("change")},_repeaterFieldFields(e,t){let a=[];return jQuery.each(t,(function(t,n){void 0!==n.type&&"repeater"===n.type&&n.name===e&&void 0!==n.fields&&(a=n.fields)})),a}};