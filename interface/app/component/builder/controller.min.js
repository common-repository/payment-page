PaymentPage.Component.builder={container:{},configuration:{sections:[],field_groups:[],field_namespace:"payment_page_form",live_preview_endpoint:""},headerContainer:{},sectionsWrapper:{},previewContainer:{},previewFormDataString:"",previewXHR:!1,Init:function(e){this.container=e;let t=this;payment_page_component_configuration_parse(this,(function(){payment_page_registerjQueryObjectSerialize(),t.loadTemplate()}))},loadTemplate:function(){let e=this,t="",a=this.configuration.sections[0].alias;t+='<div data-payment-page-component-builder-section="settings">',t+='<div data-payment-page-component-builder-section="header">',jQuery.each(this.configuration.sections,(function(e,a){t+='<div data-payment-page-component-builder-trigger="show_section_'+a.alias+'" data-payment-page-interaction-state="'+(0===e?"active":"inactive")+'">',t+="<span>"+a.title+"</span>",t+="</div>"})),t+="</div>",t+='<div data-payment-page-component-builder-section="sections_wrapper">',jQuery.each(this.configuration.field_groups,(function(i,n){let p={field_namespace:e.configuration.field_namespace,fields:n.fields,layout:"default"};t+='<div data-payment-page-component-builder-section="section_'+n.section+'" data-payment-page-interaction-state="closed" data-payment-page-display-state="'+(a===n.section?"visible":"hidden")+'"',void 0!==n.attributes&&jQuery.each(n.attributes,(function(e,a){t+=" "+e+'="'+_.escape(a)+'"'})),t+=">",t+="<p>",t+=PaymentPage.settings.svg_icon_map.angle_down,t+="<span>"+n.label+"</span>",t+="</p>",t+='<div data-payment-page-component="form" data-payment-page-component-args="'+_.escape(JSON.stringify(p))+'"></div>',t+="</div>"})),t+="</div>",t+="</div>",t+='<div data-payment-page-component-builder-section="preview">'+payment_page_element_loader()+"</div>",this.container.html(t),PaymentPage.Init(this.container),this.headerContainer=this.container.find(' > [data-payment-page-component-builder-section="settings"] > [data-payment-page-component-builder-section="header"]'),this.sectionsWrapper=this.container.find(' > [data-payment-page-component-builder-section="settings"] > [data-payment-page-component-builder-section="sections_wrapper"]'),this.previewContainer=this.container.find(' > [data-payment-page-component-builder-section="preview"]'),this._bindEvents()},_bindEvents:function(){let e=this;this.headerContainer.find(" > [data-payment-page-component-builder-trigger]").off("click").on("click",(function(t){if(t.preventDefault(),t.stopImmediatePropagation(),void 0!==jQuery(this).attr("data-payment-page-interaction-state")&&"active"===jQuery(this).attr("data-payment-page-interaction-state"))return;e.headerContainer.find(" > [data-payment-page-component-builder-trigger]").not(jQuery(this)).attr("data-payment-page-interaction-state","inactive"),jQuery(this).attr("data-payment-page-interaction-state","active");let a=jQuery(this).attr("data-payment-page-component-builder-trigger").replace("show_section_",""),i=e.sectionsWrapper.find(" > [data-payment-page-component-builder-section]"),n=e.sectionsWrapper.find(' > [data-payment-page-component-builder-section="section_'+a+'"]');i.attr("data-payment-page-interaction-state","closed"),payment_page_set_display_state_hidden(i.not(n)),payment_page_set_display_state_visible(n)})),this.sectionsWrapper.find(" > [data-payment-page-component-builder-section] > p").off("click").on("click",(function(t){t.preventDefault(),t.stopImmediatePropagation();let a=jQuery(this).parent();"closed"===a.attr("data-payment-page-interaction-state")?(a.attr("data-payment-page-interaction-state","open"),e.sectionsWrapper.find(' > [data-payment-page-component-builder-section][data-payment-page-display-state="visible"]').not(a).attr("data-payment-page-interaction-state","closed")):a.attr("data-payment-page-interaction-state","closed")})),this.sectionsWrapper.find(' > [data-payment-page-component-builder-section][data-payment-page-display-state="visible"]:first').find(" > p").trigger("click"),this.livePreview(),setTimeout((function(){e.sectionsWrapper.on("change",":input[name]",(function(){e.refreshLivePreview()}))}),2e3)},livePreview:function(e){"object"!=typeof e&&(e={});let t=this;0===t.previewContainer.find(" > .payment-page-application-loader-wrapper").length&&t.previewContainer.prepend(payment_page_element_loader("mini")),!1!==this.previewXHR&&"function"==typeof this.previewXHR.abort&&this.previewXHR.abort(),this.previewXHR=PaymentPage.API.post(this.configuration.live_preview_endpoint,e,(function(e){void 0!==e&&PaymentPage.setHTML(t.previewContainer,e),t.previewXHR=!1}))},refreshLivePreview:function(){let e=this,t=this.container.parents("form:first").paymentPageSerializeObject();jQuery.each(t,(function(a,i){a.startsWith(e.configuration.field_namespace)||delete t[a]})),this.previewFormDataString!==JSON.stringify(t)&&(this.previewFormDataString=JSON.stringify(t),this.livePreview(t))}};